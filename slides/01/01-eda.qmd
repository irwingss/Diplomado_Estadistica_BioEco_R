---
title: Estad√≠stica descriptiva
subtitle: M√≥dulo 5 - Clase 1
title-slide-attributes:
  data-background-image: ../bg4.png
  data-background-size: cover
  data-slide-number: none
format:
  revealjs:
    theme:
     - "default"
     - "../slides.scss"
    width: "1600"
    height: "900"
revealjs-plugins:
  - ace
filters:
  - shinylive
cache: true
bibliography: references.bib
---

```{r, echo=FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  fig.align = "center"
)
```

# Objetivos del m√≥dulo {background-image="../bg8.png"}

::: incremental
1.  **Comprender los conceptos fundamentales** de la estad√≠stica descriptiva y c√≥mo aplicarlos a datos biol√≥gicos y ecol√≥gicos.
2.  **Seleccionar adecuadamente** las estad√≠sticas descriptivas en funci√≥n del tipo de variable y contexto ecol√≥gico.
3.  Desarrollar **an√°lisis exploratorios de datos** (EDA) para identificar patrones en estudios ecol√≥gicos y biol√≥gicos.
4.  **Desplegar reportes EDA en GitHub** Pages para una mayor accesibilidad y transparencia en la presentaci√≥n de resultados.
:::

# Introducci√≥n

## Temario del m√≥dulo

::: incremental
-   Introducci√≥n a la estad√≠stica descriptiva.
-   Poblaci√≥n y muestra.
-   Tipos de variables.
-   Medidas de tendencia central y dispersi√≥n
-   Medidas de posici√≥n: cuartiles.
-   Distribuci√≥n de frecuencias
-   Medidas de forma: simetr√≠a y curtosis.
-   An√°lisis bivariado: covarianza y correlaci√≥n.
-   EDA: an√°lisis exploratorio.
-   Desplegar un reporte EDA en GitHub Pages.
:::

# 1. ¬øQu√© es estad√≠stica?

## La historia de (casi) tod\@s

:::::: columns
:::: column
::: incremental
-   "En alg√∫n punto de la vida acad√©mica/profesional, todos afrontamos problemas de an√°lisis de datos".
-   ¬øLe tomaste inter√©s por tu tesis de pregrado o posgrado?
-   En la era de la IA es m√°s √∫til que nunca.
:::
::::

::: column
```{r}
#| echo: false
#| out-width: "100%"

knitr::include_graphics("images/student-statistics.jpg")
```
:::
::::::

##  {.center background-color="#16161d"}

::::: columns
::: column
```{r}
#| echo: false
#| fig-align: "center"
#| out-width: "65%"

knitr::include_graphics("images/edward_deming.jpeg")
```
:::

::: column
<br> <br> <br>

> ["Sin datos no eres m√°s que otra persona con una opini√≥n" <br> *W. Edward Deming.*]{style="color:white;"}
:::
:::::

##  {.center background-color="#16161d"}

> ["La estad√≠stica no deber√≠a estar relegada a los estad√≠sticos. El objetivo es tener muchos profesionales con habilidades estad√≠stica: ingenieros, cient√≠ficos, administradores..." <br> *W. Edward Deming.*]{style="color:white;"}

##  {.center .dark-background background-image="../bg5.png"}

::: task
<strong>Estad√≠stica: Definici√≥n</strong><br> La estad√≠stica es una rama cient√≠fica que lidia con la colecta sistem√°tica, tabulaci√≥n, resumen, clasificaci√≥n, an√°lisis y modelamiento de datos, extrayendo informaci√≥n resumida a partir de datos num√©ricos (o no), de los cuales genera conclusiones √∫tiles o verifica hip√≥tesis experimentales.
:::

##  {.center background-color="#16161d"}

> [La estad√≠stica nos permite convertir datos en informaci√≥n √∫til]{style="color:white;"}

# 2. Estad√≠stica descriptiva

## ¬øQu√© hacemos en ciencias?

Como cient√≠ficos, colectamos datos como una muestra de una poblaci√≥n y usamos esos datos para generar conclusiones o hacer inferencias de la poblaci√≥n entera.

```{r}
#| echo: false
#| out-width: "65%"
#| fig-cap: "Poblaci√≥n y muestra"

knitr::include_graphics("images/muestra.webp")
```

## Abordaje en esta secci√≥n

-   Poblaci√≥n y muestra, par√°metro y estimador.
-   ¬øC√≥mo obtener la muestra?
-   ¬øQu√© se mide en la muestra?

## Poblaci√≥n y muestra

-   La **poblaci√≥n** es el conjunto de individuos u objetos de un estudio estad√≠stico.

-   Una **muestra** es un subconjunto de la poblaci√≥n.

```{r}
#| echo: false
#| out-width: "50%"
#| fig-align: "center"
#| fig-cap: ""

knitr::include_graphics("images/sampliong-eco.jpg")
```

## Par√°metro y estad√≠stico

::::: columns
::: column
```{r}
#| echo: false

knitr::include_graphics("images/bird-medidas.jpg")
```
:::

::: column
-   **Par√°metro:** Es una medida num√©rica de una caracter√≠stica resumida de una poblaci√≥n.
-   **Estad√≠stico:** Es una medida num√©rica num√©rica de una caracter√≠stica de una muestra.
:::
:::::

## Conceptos relacionados a un estad√≠stico

-   **Estimador de un par√°metro poblacional:** Es un estad√≠stico muestral utilizado para estimar o predecir el par√°metro poblacional.
-   **Estimaci√≥n de un par√°metro:** Es un valor num√©rico concreto de una estad√≠stica muestral obtenida mediante muestreo.

```{r}
#| echo: false

library(gt)
library(tibble)

# Crear el dataframe
datos_estadisticos <- tibble(
  Estad√≠stico = c("Media", "Desviaci√≥n Est√°ndar", "Varianza", "Proporci√≥n Binomial"),
  `Estad√≠stico Muestral` = c("xÃÑ", "s", "s¬≤", "pÃÇ"),
  `Par√°metro Poblacional` = c("Œº", "œÉ", "œÉ¬≤", "p")
)

# Crear la tabla con gt
tabla_estadisticos <- datos_estadisticos %>%
  gt() %>%
  cols_align(
    align = "center",
    columns = c(`Estad√≠stico Muestral`, `Par√°metro Poblacional`)
  ) %>%
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_column_labels()
  ) %>%
  opt_row_striping() %>%
  tab_options(
    column_labels.background.color = "#0013fe",
    table.font.size = px(28),
    data_row.padding = px(15)
  ) %>%
  opt_css(
    css = "
    .gt_table tr:hover td {
      background-color: #E6F3FF !important;
    }
    "
  )

# Mostrar la tabla
tabla_estadisticos
```

## ¬øC√≥mo obtener la muestra?

```{r}
#| echo: false
#| fig-align: "center"

knitr::include_graphics("images/metodos_muestreo.png")
```

## M√©todos de muestreo aleatorio

-   **Muestreo simple**: cada unidad de la poblaci√≥n tiene la misma probabilidad de ser incluida en la muestra. El muestreo es imparcial, el m√°s com√∫n y popular.

-   **Muestreo estratificado**: la poblaci√≥n se divide en dos o m√°s subpoblaciones denominadas estratos, y de cada estrato se selecciona aleatoriamente el tama√±o de muestra deseado.

-   **Muestreo de conglomerados**: se selecciona una muestra aleatoria de los estratos y, a continuaci√≥n, se obtienen muestras de estos estratos seleccionados. y, a continuaci√≥n, se obtienen muestras de estos estratos seleccionados.

-   **Muestreo sistem√°tico**: se selecciona un punto de partida aleatorio en la poblaci√≥n y luego se elige cada k-√©sima unidad para formar la muestra. El valor de k se determina dividiendo el tama√±o total de la poblaci√≥n entre el tama√±o de la muestra deseada. Este m√©todo es √∫til cuando los datos est√°n organizados en una secuencia o lista y puede ser m√°s eficiente que el muestreo simple.

## 

```{shinylive-r}
#| standalone: true
#| viewerHeight: 700


library(shiny)
library(ggplot2)
library(dplyr)

# Generar la cuadr√≠cula
grid_size <- 10  # Tama√±o de la cuadr√≠cula (10x10)
cells <- expand.grid(x = 1:grid_size, y = 1:grid_size)
cells$id <- 1:nrow(cells)

ui <- fluidPage(
  titlePanel("Visualizaci√≥n de M√©todos de Muestreo en una Cuadr√≠cula"),
  sidebarLayout(
    sidebarPanel(
      selectInput("sampling_method", "Selecciona el M√©todo de Muestreo:",
                  choices = c("Muestreo Simple",
                              "Muestreo Estratificado",
                              "Muestreo por Conglomerados",
                              "Muestreo Sistem√°tico")),
      numericInput("sample_size", "Tama√±o de la Muestra:", value = 20, min = 1, max = nrow(cells)),
      conditionalPanel(
        condition = "input.sampling_method == 'Muestreo Estratificado'",
        numericInput("n_strata", "N√∫mero de Estratos:", value = 2, min = 2, max=2)
      ),
      conditionalPanel(
        condition = "input.sampling_method == 'Muestreo por Conglomerados'",
        numericInput("cluster_rows", "Filas por Conglomerado:", value = 2, min = 1),
        numericInput("cluster_cols", "Columnas por Conglomerado:", value = 2, min = 1)
      ),
      conditionalPanel(
        condition = "input.sampling_method == 'Muestreo Sistem√°tico'",
        numericInput("k_value", "Valor de k (intervalo de muestreo):", value = 5, min = 1)
      ),
      actionButton("sample_button", "Tomar Muestra")
    ),
    mainPanel(
      plotOutput("grid_plot", height = "600px")
    )
  )
)

server <- function(input, output) {
  
  sampled_data <- eventReactive(input$sample_button, {
    method <- input$sampling_method
    n <- input$sample_size
    grid <- cells  # Copia de la cuadr√≠cula
    grid$selected <- FALSE
    
    if (method == "Muestreo Simple") {
      sample_ids <- sample(grid$id, n)
      grid$selected[grid$id %in% sample_ids] <- TRUE
      
    } else if (method == "Muestreo Estratificado") {
      n_strata <- input$n_strata
      grid$stratum <- cut(grid$id, breaks = n_strata, labels = FALSE)
      strata <- unique(grid$stratum)
      samples_per_stratum <- n %/% length(strata)
      extra_samples <- n %% length(strata)
      for (s in strata) {
        stratum_cells <- grid %>% filter(stratum == s)
        stratum_n <- samples_per_stratum + ifelse(s <= extra_samples, 1, 0)
        sample_ids <- sample(stratum_cells$id, min(stratum_n, nrow(stratum_cells)))
        grid$selected[grid$id %in% sample_ids] <- TRUE
      }
      
    } else if (method == "Muestreo por Conglomerados") {
      cluster_rows <- input$cluster_rows
      cluster_cols <- input$cluster_cols
      num_clusters_row <- grid_size %/% cluster_rows
      num_clusters_col <- grid_size %/% cluster_cols
      grid$cluster_row <- ((grid$y - 1) %/% cluster_rows) + 1
      grid$cluster_col <- ((grid$x - 1) %/% cluster_cols) + 1
      grid$cluster_id <- paste0(grid$cluster_row, "-", grid$cluster_col)
      clusters <- unique(grid$cluster_id)
      clusters_selected <- sample(clusters, size = ceiling(length(clusters) * n / nrow(grid)))
      grid$selected[grid$cluster_id %in% clusters_selected] <- TRUE
      
    } else if (method == "Muestreo Sistem√°tico") {
      k <- input$k_value
      start <- sample(1:k, 1)
      grid <- grid %>% arrange(y, x)
      sample_indices <- seq(start, by = k, length.out = n)
      sample_indices <- sample_indices[sample_indices <= nrow(grid)]
      grid$selected[sample_indices] <- TRUE
    }
    return(grid)
  })
  
  output$grid_plot <- renderPlot({
    req(sampled_data())
    grid <- sampled_data()
    method <- input$sampling_method
    
    p <- ggplot(grid, aes(x = x, y = y)) +
      geom_tile(aes(fill = selected), color = "black") +
      scale_fill_manual(values = c("FALSE" = "white", "TRUE" = "red"), guide = FALSE) +
      theme_minimal() +
      coord_fixed() +
      labs(title = paste("M√©todo de Muestreo:", method),
           x = "", y = "") +
      theme(axis.text = element_blank(),
            axis.ticks = element_blank())
    
    # A√±adir numeraci√≥n
    p <- p + geom_text(aes(label = id, color = selected), 
                       size = 8) +
      scale_color_manual(values = c("FALSE" = "transparent", "TRUE" = "white"), guide = FALSE) 
    
    if (method == "Muestreo Estratificado") {
      p <- p + facet_wrap(~ stratum) +
        labs(subtitle = paste("N√∫mero de Estratos:", input$n_strata))
      
    } else if (method == "Muestreo por Conglomerados") {
      cluster_rows <- input$cluster_rows
      cluster_cols <- input$cluster_cols
      p <- p +
        geom_hline(yintercept = seq(0.5, grid_size + 0.5, by = cluster_rows), color = "blue", linetype = "dashed", lwd = 1) +
        geom_vline(xintercept = seq(0.5, grid_size + 0.5, by = cluster_cols), color = "blue", linetype = "dashed", lwd = 1) +
        labs(subtitle = paste("Conglomerados de", cluster_rows, "x", cluster_cols, "celdas"))
      
    } else if (method == "Muestreo Sistem√°tico") {
      k <- input$k_value
      p <- p + labs(subtitle = paste("Valor de k =", k))
    }
    
    print(p)
  })
}

shinyApp(ui = ui, server = server)

```

## ¬øQu√© se mide en la muestra?

### Tipos de Variables y Escalas de Medici√≥n

Comprender los tipos de variables es fundamental para elegir las estad√≠sticas descriptivas adecuadas.

::: incremental
-   **Nominales**: clasificaci√≥n sin orden (e.g., tipos de h√°bitat, especies/ g√©neros/ familias/ √≥rdenes, estaci√≥n, sexo).

-   **Ordinales**: clasificaci√≥n con orden intr√≠nseco (e.g., estadios de desarrollo, grupo etario, grado de perturbaci√≥n, nivel de contaminaci√≥n categ√≥rico).

-   **Cuantitativas continuas**: son num√©ricas obtenidas de procesos de medici√≥n. Tienen decimales.

-   **Cuantitativas discretas**: son num√©ricas obtenidas de procesos de conteo. Son n√∫meros enteros, mayores/iguales a cero, siempre.

-   **De raz√≥n**: num√©ricas que incluyen un cero absoluto (e.g., peso, altura).

-   **De intervalo**: diferencias significativas pero sin un cero absoluto (e.g., temperatura en Celsius).
:::

# 3. ¬øQu√© influencia a que un estudio sea estad√≠sticamente bueno?

## Abordaje en esta secci√≥n

-   Tama√±o de la muestra (??).
-   El margen de error (\<10%).
-   Nivel de confianza (95%).
-   Influencia del N muestral (simulaci√≥n).
-   ¬øC√≥mo afecta el N al estimador?: Funci√≥n de densidad.

## Tama√±o de la muestra

::::::: columns
:::: column
### **¬øDebe ser muy grande?**

::: incremental
-   Hacer que sea grande, es **costoso**.
-   Por s√≠ solo, no asegura mayor certeza.
-   **Dise√±o muestral** es importante.
:::

```{r}
#| echo: false

knitr::include_graphics("https://plus.unsplash.com/premium_photo-1664304394734-b991b0fc4132?q=80&w=2382&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D")
```
::::

:::: column
<https://www.surveymonkey.com/mp/sample-size-calculator/>

```{r}
#| echo: false

knitr::include_graphics("images/surveymonkey.png")
```

**Pasos recomendados:**

::: incremental
1.  Define la poblaci√≥n.
2.  Define tu margen de error.
3.  Define tu nivel de confianza.
:::
::::
:::::::

## ¬øQu√© es el margen de error?

:::::: columns
::: column
¬øC√≥mo saber si la respuesta obtenida refleja el par√°metro de la poblaci√≥n?

```{r}
#| echo: false

knitr::include_graphics("images/covid_prob.png")
```
:::

:::: column
> Si preguntas aun grupo de personas si se vacunar√≠a contra la COVID-19, la respuesta es dicot√≥mica.

::: incremental
-   Si 70% de los evaluado dicen que s√≠ se vacunar√°n, un 5% de margen de error significa implica que el valor fluctuar√° en la poblaci√≥n e 65% a 75%.
-   M√°rgenes de error superiores al 10% no son recomendados
:::
::::
::::::

## Margen de error

### Margen de error del estimador promedio:

$$
ME = Z \times \frac{S}{\sqrt{n}}
$$

### Margen de error de una proporci√≥n:

$$
ME = Z \times \sqrt{\frac{p \times (1 - p)}{n}}
$$

## ¬øC√≥mo influencia el tama√±o de la muestra?

La siguiente es una app creada con la nueva extensi√≥n de Quarto "Shinylive" para R. Esta app din√°mica nos permitir√° entender qu√© ocurre cuando se modifica el N muestral para muestrear una poblaci√≥n dada:

```{r}
#| echo: false
#| out-width: "100%"
#| fig-cap: ""

knitr::include_graphics("images/app shiny1.png")

```

::: footer
Versi√≥n original: [coatless-quarto](https://quarto.thecoatlessprofessor.com/r-shinylive-demo/R-shinylive-demo.html)
:::

## 

```{shinylive-r}
#| standalone: true
#| viewerHeight: 700

library(shiny)
library(bslib)

theme <- bs_theme(font_scale = 2.5)

ui <- page_sidebar(
  sidebar = sidebar(open = "open",
                    fileInput("file", "Subir archivo CSV"),
                    uiOutput("column_selector"), # Selector de columna din√°mico
                    numericInput("n", "Sample count", 100),
                    checkboxInput("pause", "Pause", FALSE)
  ),
  plotOutput("plot", width=1200)
)

server <- function(input, output, session) {
  
  # Reactivo para leer el archivo CSV
  data_file <- reactive({
    req(input$file)
    read.csv(input$file$datapath)
  })
  
  # Crear UI din√°mico para el selector de columnas
  output$column_selector <- renderUI({
    req(data_file())
    selectInput("selected_column", "Seleccione una columna", 
                choices = names(data_file()), selected = names(data_file())[1])
  })
  
  # Reactivo para extraer la columna seleccionada
  selected_data <- reactive({
    req(input$selected_column)
    column_data <- data_file()[[input$selected_column]]
    
    # Filtra solo los valores num√©ricos
    column_data <- column_data[is.numeric(column_data)]
    
    # Asegura que no hay NA y retorna los datos
    na.omit(column_data)
  })
  
  # Reactivo para generar los datos simulados basados en la columna seleccionada
  data_simulated <- reactive({
    req(selected_data())
    
    if (!isTRUE(input$pause)) {
      invalidateLater(1000)
    }
    
    # Simular la distribuci√≥n normal basada en la media y desviaci√≥n est√°ndar de la columna
    rnorm(input$n, mean = mean(selected_data()), sd = sd(selected_data()))
  })
  
  # Renderiza el histograma basado en la simulaci√≥n
  output$plot <- renderPlot({
    req(data_simulated(), selected_data())
    
    # Establece l√≠mites din√°micos del eje X basados en los valores reales de la columna
    x_min <- min(selected_data(), na.rm = TRUE)
    x_max <- max(selected_data(), na.rm = TRUE)
    
    # Calcula la media de la columna seleccionada (poblacional)
    poblational_mean <- mean(selected_data(), na.rm = TRUE)
    
    hist(data_simulated(),
         breaks = 40,
         xlim = c(x_min, x_max),  # Actualiza los l√≠mites del eje X
         ylim = c(0, 1),
         lty = "blank",
         xlab = "Valores de la variable seleccionada",
         ylab = "Densidad",
         freq = FALSE,
         main = "Histograma de Frecuencia"
    )
    
    x <- seq(from = x_min, to = x_max, length.out = 500)
    y <- dnorm(x, mean = mean(selected_data()), sd = sd(selected_data()))
    lines(x, y, lwd=1.5)
    
    lwd <- 5
    # L√≠nea roja para el promedio poblacional
    abline(v=poblational_mean, col="red", lwd=lwd, lty=2)  # Media poblacional
    abline(v=mean(data_simulated()), col="blue", lwd=lwd, lty=1)  # Media de la muestra simulada
    
    legend(legend = c("Dist. Normal", "Promedio Poblacional", "Promedio Muestral"),
           col = c("black", "red", "blue"),
           lty = c(1, 2, 1),
           lwd = c(1, lwd, lwd),
           x = x_max - (x_max - x_min) * 0.25,
           y = 0.7,
           cex = 0.7,
    )
  }, res=140)
}

# Create Shiny app ----
shinyApp(ui = ui, server = server)

```

## Funci√≥n de Densidad del Par√°metro (Poblaci√≥n)

```{r}
#| echo: false
#| fig-align: center

# Cargar las librer√≠as necesarias
library(ggplot2)

# Crear datos de ejemplo
set.seed(1000)
data <- rnorm(1000, mean = 50, sd = 15)  
sample_points <- sample(data, 20)

# Gr√°fico
p <- ggplot(data = data.frame(x = data), aes(x = x)) + 
  geom_density(fill = "#ffc9d8", color = "#f50041", alpha = 0.4) + 
  geom_vline(aes(xintercept = mean(data)), 
             color = "#f50041", lwd = 1.5) + 
  geom_point(data = data.frame(x = sample_points),
             aes(x = x, y = 0), color = "#2a00e3", size = 4, alpha = 0.15) +
  geom_rug(data = data.frame(x = sample_points),
             aes(x = x),alpha = 0.3, color = "#2a00e3")+
  annotate("text", x = mean(data), y = 0.005, 
           label = "Promedio poblacional (¬µ)", 
           color = "#f50041", angle = 90, vjust = -0.5, hjust = 0) +
annotate("text", x = 65, y = 0.02, 
           label = "Distribuci√≥n de\nfrecuencias del\npar√°metro (Œº; N = 1000)",
           lineheight = 1,
           color = "#f50041", hjust = 0, fontface =2) +
  annotate("text", x = mean(sample_points) - 5, y = -0.002, 
           label = "Puntos de muestreo (n = 20)", color = "#2a00e3", 
           vjust = 0, hjust = 1) +
  theme_minimal() +
  theme(axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) +
  xlab("Valores de la variable")

# Mostrar el gr√°fico
print(p)

```

## Funci√≥n de Densidad del Estimador (muestra)

```{r}
#| echo: false
#| fig-align: center

# Cargar las librer√≠as necesarias
library(ggplot2)

# Crear datos de ejemplo
set.seed(1000)
data <- rnorm(1000, mean = 50, sd = 15)  
sample_points <- sample(data, 20)

# Gr√°fico
p <- ggplot(data = data.frame(x = data), aes(x = x)) + 
  geom_density(fill = "#d1d1d1", color = "#8f8f8f", alpha = 0.4) + 
  geom_density(data = data.frame(x = sample_points),
             aes(x = x), fill = "#a896ff", color = "#2a00e3", alpha = 0.15) + 
  geom_vline(aes(xintercept = mean(data)), 
             color = "#f50041", lwd = 1.5) + 
  geom_vline(aes(xintercept = mean(sample_points)), 
             color = "#2a00e3", lwd = 1.5) + 
  geom_point(data = data.frame(x = sample_points),
             aes(x = x, y = 0), color = "#2a00e3", size = 4, alpha = 0.15) +
  geom_rug(data = data.frame(x = sample_points),
             aes(x = x),alpha = 0.3, color = "#2a00e3")+
  annotate("text", x = mean(data), y = 0.005, 
           label = "Promedio poblacional (¬µ)", 
           color = "#f50041", angle = 90, vjust = -0.5, hjust = 0) +
  annotate("text", x = mean(sample_points), y = 0.005, 
           label = "Promedio de la muestra (XÃÑ)",
           color = "#2a00e3", angle = 90, vjust = -0.5, hjust = 0) +
  annotate("text", x = 15, y = 0.02, 
           label = "Distribuci√≥n de\nfrecuencias del\npar√°metro (Œº; N = 1000)",
           lineheight = 1,
           color = "#8f8f8f", hjust = 0, fontface =2) +
   annotate("text", x = 75, y = 0.02, 
           label = "Distribuci√≥n de\nfrecuencias del\nestimador (XÃÑ; N = 20)",
           lineheight = 1,
           color = "#2a00e3", hjust = 0, fontface =2) +
  annotate("text", x = mean(sample_points) - 5, y = -0.002, 
           label = "Puntos de muestreo (n = 20)", color = "#2a00e3", 
           vjust = 0, hjust = 1) +
  theme_minimal() +
  theme(axis.title.y = element_blank(),
        axis.text.y = element_blank(),
        axis.ticks.y = element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank()) +
  xlab("Valores de la variable")

# Mostrar el gr√°fico
print(p)

```

##  {.center background-image="../landscape3.jpg"}

::: task
Ya tomaste la muestra, y esta tiene caracter√≠sticias intr√≠nsecas.<br>Para hablar de ellas, veamos [qu√© es probabilidad.]{.gradiente}
:::

# 4. Probabilidades vs Estad√≠stica

## ¬øQu√© significa probabilidad?

::: incremental
-   Es la **medida de la incertidumbre** o la posibilidad de que ocurra un evento.\
-   Si algo es **seguro**, la probabilidad es 1 (o 100%), y si es **imposible**, la probabilidad es 0 (o 0%).
-   La **probabilidad** de un evento es su **frecuencia relativa** (proporci√≥n esperada).
:::

<br>

::: {.fragment .fade-up}
Si un evento $A$ ocurre $x$ veces de un total de $n$, su probabilidad converge (a la larga) en:

$$
P(A)=\frac{x}{n}=\frac{\text{N√∫mero total de resultados favorables}}{\text{N√∫mero total de resultados posibles}}
$$
:::

:::: {.fragment .fade-up}
::: callout-tip
Cuando $n$ es peque√±o, la frecuencia relativa observada de un suceso **no es un reflejo fiable de su probabilidad**.
:::
::::

## ¬øProbabilidad es diferente que estad√≠stica?

La **probabilidad** y la **estad√≠stica** son ramas de las matem√°ticas que est√°n relacionadas pero tienen enfoques diferentes

::: {.fragment .fade-up}
```{r}
#| echo: false
#| fig-align: center
#| out-width: "80%"

knitr::include_graphics("images/teoria_probabilidad_estadistica.png")
```
:::

##  {.center}

```{r}
#| echo: false

library(gt)
library(tibble)

# Crear el dataframe
datos_diferencias <- tibble(
  Caracter√≠stica = c("Enfoque", "Para", "Objetivo", "Ejemplo", "Punto de partida", "Uso"),
  Probabilidad = c(
    "Predicci√≥n de eventos futuros", "Predecir eventos futuros",
    "Cuantificar la incertidumbre de eventos antes de que sucedan", 
    "Calcular la probabilidad de obtener cara en un lanzamiento de moneda", 
    "Modelo te√≥rico de una situaci√≥n aleatoria", 
    "Predice probabilidades de eventos"
  ),
  Estad√≠stica = c(
    "An√°lisis de datos observados", "Inferir caracter√≠sticas de una poblaci√≥n o fen√≥meno",
    "Inferir caracter√≠sticas de una poblaci√≥n a partir de los datos", 
    "Analizar el n√∫mero de caras obtenidas en 100 lanzamientos de moneda", 
    "Datos reales observados", 
    "Toma decisiones, realiza inferencias, o estima par√°metros"
  )
)

# Crear la tabla con gt
tabla_diferencias <- datos_diferencias %>%
  gt() %>%
  cols_align(
    align = "center",
    columns = c(`Probabilidad`, `Estad√≠stica`)
  ) %>%
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_column_labels()
  ) %>%
  opt_row_striping() %>%
  tab_options(
    column_labels.background.color = "#0013fe",
    table.font.size = px(28),
    data_row.padding = px(15)
  ) %>%
  opt_css(
    css = "
    .gt_table tr:hover td {
      background-color: #E6F3FF !important;
    }
    "
  )

# Mostrar la tabla
tabla_diferencias
```

##  {.center}

```{r}
#| echo: false

library(gt)
library(tibble)

# Crear el dataframe
datos_campos_aplicacion <- tibble(
  Campo = c("üèú Macroecolog√≠aÔ∏è", "ü¶ú Bioac√∫stica", "ü¶§ Distribuci√≥n de especies", "ü¶ê Macroinvertebrados", "ü™ª Biodiversidad bot√°nica", "üå± Agronom√≠a"),
  Probabilidad = c(
    "Modelar la probabilidad de extinci√≥n de especies en grandes escalas geogr√°ficas.",
    "Calcular la probabilidad de que ciertos patrones ac√∫sticos sean emitidos por especies espec√≠ficas.",
    "Predecir la probabilidad de que una especie est√© presente en un √°rea a√∫n no muestreada.",
    "Estimar la probabilidad de encontrar una especie invasora en un h√°bitat a partir de datos limitados.",
    "Calcular la probabilidad de la aparici√≥n de especies raras en una zona de alta biodiversidad.",
    "Estimar la probabilidad de que un tipo de cultivo resista condiciones clim√°ticas extremas."
  ),
  Estad√≠stica = c(
    "Analizar datos observados de tama√±os de √°reas y riqueza de especies para inferir patrones macroecol√≥gicos.",
    "Evaluar la variabilidad y patrones en los datos ac√∫sticos recogidos para identificar especies.",
    "Analizar la distribuci√≥n observada de especies para estimar sus rangos geogr√°ficos.",
    "Realizar an√°lisis de diversidad para describir la composici√≥n de comunidades de macroinvertebrados en diferentes h√°bitats.",
    "Analizar los datos de inventarios bot√°nicos para estimar la diversidad y la riqueza de especies.",
    "Evaluar la productividad observada de diferentes cultivos bajo distintos tratamientos agr√≠colas."
  )
)

# Crear la tabla con gt
tabla_campos_aplicacion <- datos_campos_aplicacion %>%
  gt() %>%
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_body(
      columns = c(Campo)
    )
  )%>%
  cols_align(
    align = "center",
    columns = c(`Probabilidad`, `Estad√≠stica`)
  ) %>%
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_column_labels()
  ) %>%
  opt_row_striping() %>%
  tab_options(
    column_labels.background.color = "#0013fe",
    table.font.size = px(28),
    data_row.padding = px(15)
  ) %>%
  opt_css(
    css = "
    .gt_table tr:hover td {
      background-color: #E6F3FF !important;
    }
    "
  )

# Mostrar la tabla
tabla_campos_aplicacion

```

# Teor√≠a de Probabilidad

## Variables Aleatorias y Distribuciones

Una variable aleatoria es una **funci√≥n** que asigna un valor num√©rico a cada uno de los resultados posibles de un experimento aleatorio.

Se clasifica en dos tipos principales:

-   **Variable Aleatoria Discreta**: Toma un n√∫mero finito o contable de valores (Ej. n√∫mero de individuos en una poblaci√≥n).
-   **Variable Aleatoria Continua**: Puede tomar cualquier valor dentro de un intervalo (Ej. la altura de una planta).

## Distribuciones de probabilidad

-   Una distribuci√≥n de probabilidad describe c√≥mo se distribuyen los resultados posibles de un evento aleatorio.

-   Nos indica cu√°n probable es que ocurran los diferentes resultados de un experimento aleatorio.

```{r}
#| echo: false
#| warning: false
#| message: false
#| fig-align: "center"

# Cargar las librer√≠as necesarias
library(ggplot2)
library(gridExtra)

# Definir una funci√≥n para crear histogramas con diferentes distribuciones y t√≠tulos
create_distribution_plot <- function(data, color, title) {
  ggplot(data, aes(x = values)) +
    geom_histogram(binwidth = 0.5, fill = color, color = "black", alpha = 0.7) +
    theme_minimal() +
    ggtitle(title) +
    theme(axis.title.x = element_blank(),
          axis.title.y = element_blank(),
          axis.text.x = element_blank(),
          axis.text.y = element_blank(),
          axis.ticks = element_blank(),
          plot.title = element_text(size = 10, hjust = 0.5),
          plot.margin = margin(5, 5, 5, 5, "pt"))
}

# Generar los datos para cada distribuci√≥n
set.seed(123)
uniform_data <- data.frame(values = runif(10000, min = 10, max = 30))
normal_data <- data.frame(values = rnorm(10000, mean = 10, sd = 50))
standard_normal_data <- data.frame(values = rnorm(10000, mean = 0, sd = 1))
gamma_data <- data.frame(values = rgamma(10000, shape = 5, scale = 2))
exponential_data <- data.frame(values = rexp(10000, rate = 1))
beta_data <- data.frame(values = rbeta(10000, shape1 = 5, shape2 = 2))
binomial_data <- data.frame(values = rbinom(10000, size = 10, prob = 0.8))
poisson_data <- data.frame(values = rpois(10000, lambda = 3))
bernoulli_data <- data.frame(values = rbinom(10000, size = 1, prob = 0.6))

# Crear los gr√°ficos de cada distribuci√≥n con sus t√≠tulos
plot1 <- create_distribution_plot(uniform_data, "firebrick", "Uniform (C)")
plot2 <- create_distribution_plot(normal_data, "cornflowerblue", "Normal (C)")
plot3 <- create_distribution_plot(standard_normal_data, "cyan4", "Standard Normal (C)")
plot4 <- create_distribution_plot(gamma_data, "chartreuse3", "Gamma (C)")
plot5 <- create_distribution_plot(exponential_data, "orange", "Exponential (C)")
plot6 <- create_distribution_plot(beta_data, "gold", "Beta (C)")
plot7 <- create_distribution_plot(binomial_data, "blueviolet", "Binomial (D)")
plot8 <- create_distribution_plot(poisson_data, "azure4", "Poisson (D)")
plot9 <- create_distribution_plot(bernoulli_data, "deeppink", "Bernoulli (D)")

# Usar grid.arrange para combinar los gr√°ficos en una sola imagen
grid.arrange(plot1, plot2, plot3, plot4, plot5, plot6, plot7, plot8, plot9, nrow = 3, ncol = 3)

```

## Distribuciones Discretas

::: incremental
-   Describe variables obtenidas de procesos de **conteos**.
-   Posibilidades de **valores finitos**.
-   Se usa la *funci√≥n de masa de probabilidad* (*PMF*) para asignar una probabilidad a *cada valor* posible de la variable.
-   La PMF toma un valor espec√≠fico y devuelve la probabilidad de que la variable tome ese valor.
:::

:::: {.fragment .fade-up}
::: callout-tip
Cuando $n$ es peque√±o, la frecuencia relativa observada de un suceso **no es un reflejo fiable de su probabilidad**.
:::
::::

## Distribuciones continuas

::: incremental
-   Describe variables obtenidas de procesos de **medici√≥n**.
-   Posibilidades de **valores infinitos**.
-   Se usa la *funci√≥n de densidad de probabilidad* (*PDF*) para asignar la probabilidad de que una variable caiga *dentro de un rango espec√≠fico*.
-   La PDF no devuelve una probabilidad directa para un valor espec√≠fico.
:::

## 

```{shinylive-r}
#| standalone: true
#| viewerHeight: 760
library(shiny)
library(ggplot2)

# Definici√≥n de la interfaz de usuario
ui <- fluidPage(
  titlePanel("App de Probabilidad Interactiva"),
  
  sidebarLayout(
    sidebarPanel(
      selectInput("dist", "Selecciona la Distribuci√≥n:",
                  choices = c("Binomial", "Poisson", "Geom√©trica", "Hipergeom√©trica", 
                              "Normal", "Exponencial", "Gamma", "Beta", 
                              "Cauchy", "Uniforme", "Log-Normal", "Chi-cuadrado",
                              "t-Student", "F-Snedecor")),
      
      # Paneles condicionales para cada distribuci√≥n
      conditionalPanel(
        condition = "input.dist == 'Binomial'",
        numericInput("size_binom", "N√∫mero de Ensayos (n):", value = 10, min = 1),
        numericInput("prob_binom", "Probabilidad de √âxito (p):", value = 0.5, min = 0, max = 1)
      ),
      conditionalPanel(
        condition = "input.dist == 'Poisson'",
        numericInput("lambda_pois", "Par√°metro Lambda (Œª):", value = 5, min = 0)
      ),
      conditionalPanel(
        condition = "input.dist == 'Geom√©trica'",
        numericInput("prob_geom", "Probabilidad de √âxito (p):", value = 0.5, min = 0, max = 1)
      ),
      conditionalPanel(
        condition = "input.dist == 'Hipergeom√©trica'",
        numericInput("m_hyper", "N√∫mero de √âxitos en la Poblaci√≥n (K):", value = 7, min = 1),
        numericInput("n_hyper", "N√∫mero de Fracasos en la Poblaci√≥n (N-K):", value = 13, min = 1),
        numericInput("k_hyper", "Tama√±o de la Muestra (n):", value = 10, min = 1)
      ),
      conditionalPanel(
        condition = "input.dist == 'Normal'",
        numericInput("mean_norm", "Media (Œº):", value = 0),
        numericInput("sd_norm", "Desviaci√≥n Est√°ndar (œÉ):", value = 1, min = 0)
      ),
      conditionalPanel(
        condition = "input.dist == 'Exponencial'",
        numericInput("rate_exp", "Tasa (Œª):", value = 1, min = 0)
      ),
      conditionalPanel(
        condition = "input.dist == 'Gamma'",
        numericInput("shape_gamma", "Forma (Œ±):", value = 2, min = 0),
        numericInput("rate_gamma", "Tasa (Œ≤):", value = 1, min = 0)
      ),
      conditionalPanel(
        condition = "input.dist == 'Beta'",
        numericInput("shape1_beta", "Par√°metro Alpha (Œ±):", value = 2, min = 0),
        numericInput("shape2_beta", "Par√°metro Beta (Œ≤):", value = 5, min = 0)
      ),
      # Bot√≥n para simular
      actionButton("simulate", "Simular"),
      
      # Texto descriptivo de la distribuci√≥n
      h3("Descripci√≥n de la distribuci√≥n seleccionada"),
      uiOutput("description")  # Aqu√≠ se mostrar√° el texto regular
    ),
    
    mainPanel(
      plotOutput("distPlot"),
      verbatimTextOutput("summary")
    )
  )
)

# Definici√≥n de la l√≥gica del servidor
server <- function(input, output) {
  
  # Funci√≥n para generar la descripci√≥n de la distribuci√≥n
  output$description <- renderUI({
    if (input$dist == "Binomial") {
      withMathJax(HTML("<p><strong>La distribuci√≥n binomial:</strong> Modela el n√∫mero de √©xitos en <em>n</em> ensayos independientes con una probabilidad <em>p</em> fija.</p>
          <p>F√≥rmula: $$P(X = k) = \\binom{n}{k} p^k (1-p)^{n-k}$$</p>
          <p><strong>Ejemplo 1:</strong> Supervivencia de pl√°ntulas en una poblaci√≥n, donde <em>p</em> es la probabilidad de supervivencia de cada pl√°ntula.</p>
          <p><strong>Ejemplo 2:</strong> N√∫mero de especies con una caracter√≠stica gen√©tica particular en una muestra de individuos.</p>"))
    } else if (input$dist == "Poisson") {
      withMathJax(HTML("<p><strong>La distribuci√≥n de Poisson:</strong> Describe el n√∫mero de eventos que ocurren en un intervalo de tiempo o espacio dado, con una tasa constante <em>Œª</em>.</p>
          <p>F√≥rmula: $$P(X = k) = \\frac{\\lambda^k e^{-\\lambda}}{k!}$$</p>
          <p><strong>Ejemplo 1:</strong> N√∫mero de individuos de una especie rara en una parcela de terreno.</p>
          <p><strong>Ejemplo 2:</strong> N√∫mero de llamadas a una estaci√≥n de monitoreo ambiental en un d√≠a.</p>"))
    } else if (input$dist == "Geom√©trica") {
      withMathJax(HTML("<p><strong>La distribuci√≥n geom√©trica:</strong> Modela el n√∫mero de ensayos hasta obtener el primer √©xito, donde <em>p</em> es la probabilidad de √©xito en cada ensayo.</p>
          <p>F√≥rmula: $$P(X = k) = (1-p)^{k-1} p$$</p>
          <p><strong>Ejemplo 1:</strong> N√∫mero de intentos hasta encontrar la primera especie rara en una expedici√≥n.</p>
          <p><strong>Ejemplo 2:</strong> N√∫mero de observaciones de depredadores hasta ver una captura exitosa.</p>"))
    } else if (input$dist == "Hipergeom√©trica") {
      withMathJax(HTML("<p><strong>La distribuci√≥n hipergeom√©trica:</strong> Modela el n√∫mero de √©xitos en una muestra sin reemplazo de una poblaci√≥n finita.</p>
          <p>F√≥rmula: $$P(X = k) = \\frac{\\binom{K}{k} \\binom{N-K}{n-k}}{\\binom{N}{n}}$$</p>
          <p><strong>Ejemplo 1:</strong> N√∫mero de plantas con flor en una muestra tomada de un ecosistema.</p>
          <p><strong>Ejemplo 2:</strong> N√∫mero de especies invasoras detectadas en un √°rea protegida tras muestrear sin reemplazo.</p>"))
    } else if (input$dist == "Normal") {
      withMathJax(HTML("<p><strong>La distribuci√≥n normal:</strong> Describe variables continuas cuya distribuci√≥n se agrupa alrededor de una media <em>Œº</em>, con una desviaci√≥n est√°ndar <em>œÉ</em>.</p>
          <p>F√≥rmula: $$f(x) = \\frac{1}{\\sigma\\sqrt{2\\pi}} e^{-\\frac{(x-\\mu)^2}{2\\sigma^2}}$$</p>
          <p><strong>Ejemplo 1:</strong> Distribuci√≥n de alturas de los √°rboles en un bosque.</p>
          <p><strong>Ejemplo 2:</strong> Peso de los individuos de una especie animal en una poblaci√≥n natural.</p>"))
    }
    else if (input$dist == "Gamma") {
      withMathJax(HTML("<p><strong>La distribuci√≥n Gamma:</strong> Modela tiempos de espera de un evento en un proceso en el que suceden m√∫ltiples eventos de manera continua. Utiliza dos par√°metros: <em>Œ±</em> (forma) y <em>Œ≤</em> (tasa).</p>
          <p>F√≥rmula: $$f(x; \\alpha, \\beta) = \\frac{\\beta^{\\alpha}}{\\Gamma(\\alpha)} x^{\\alpha-1} e^{-\\beta x}$$</p>
          <p><strong>Ejemplo 1:</strong> Tiempo hasta que un ecosistema se recupere despu√©s de un disturbio.</p>
          <p><strong>Ejemplo 2:</strong> Modelar el tiempo que tarda un cultivo en alcanzar su madurez.</p>"))
    } else if (input$dist == "Exponencial") {
      withMathJax(HTML("<p><strong>La distribuci√≥n Exponencial:</strong> Modela el tiempo entre eventos en un proceso de Poisson con tasa constante. Se describe con el par√°metro <em>Œª</em>.</p>
          <p>F√≥rmula: $$f(x; \\lambda) = \\lambda e^{-\\lambda x}$$</p>
          <p><strong>Ejemplo 1:</strong> Tiempo hasta la pr√≥xima aparici√≥n de un incendio en un ecosistema.</p>
          <p><strong>Ejemplo 2:</strong> Tiempo de espera entre eventos de depredaci√≥n en un sistema ecol√≥gico.</p>"))
    } else if (input$dist == "Beta") {
      withMathJax(HTML("<p><strong>La distribuci√≥n Beta:</strong> Modela variables continuas entre 0 y 1, a menudo utilizada en la modelizaci√≥n de proporciones. Se describe con los par√°metros <em>Œ±</em> (shape1) y <em>Œ≤</em> (shape2).</p>
          <p>F√≥rmula: $$f(x; \\alpha, \\beta) = \\frac{x^{\\alpha-1}(1-x)^{\\beta-1}}{B(\\alpha, \\beta)}$$</p>
          <p><strong>Ejemplo 1:</strong> Proporci√≥n de la poblaci√≥n que sobrevive en diferentes condiciones ambientales.</p>
          <p><strong>Ejemplo 2:</strong> Fracci√≥n del √°rea de un ecosistema afectada por una perturbaci√≥n.</p>"))
    }
  })
  
  data <- eventReactive(input$simulate, {
    if (input$dist == "Binomial") {
      rbinom(1000, Csize = input$size_binom, prob = input$prob_binom)
    } else if (input$dist == "Poisson") {
      rpois(1000, lambda = input$lambda_pois)
    } else if (input$dist == "Geom√©trica") {
      rgeom(1000, prob = input$prob_geom)
    } else if (input$dist == "Hipergeom√©trica") {
      rhyper(1000, m = input$m_hyper, n = input$n_hyper, k = input$k_hyper)
    } else if (input$dist == "Normal") {
      rnorm(1000, mean = input$mean_norm, sd = input$sd_norm)
    } else if (input$dist == "Exponencial") {
      rexp(1000, rate = input$rate_exp)
    } else if (input$dist == "Gamma") {
      rgamma(1000, shape = input$shape_gamma, rate = input$rate_gamma)
    } else if (input$dist == "Beta") {
      rbeta(1000, shape1 = input$shape1_beta, shape2 = input$shape2_beta)
    }
  })
  
  output$distPlot <- renderPlot({
    req(data())
    dist_data <- data()
    ggplot(data.frame(x = dist_data), aes(x = x)) +
      geom_histogram(binwidth = 1, color = "black", fill = "lightblue") +
      theme_minimal() +
      labs(title = paste("Distribuci√≥n", input$dist),
           x = "Valor", y = "Frecuencia")
  })
  
  output$summary <- renderPrint({
    summary(data())
  })
}

# Ejecutar la aplicaci√≥n Shiny
shinyApp(ui = ui, server = server)

```

## Probabilidad de Mantenimiento de Funciones Ecol√≥gicas

::::: columns
::: column
-   **¬øc√≥mo la probabilidad de extinci√≥n de especies afecta la probabilidad de mantener funciones clave en un ecosistema?** [@nijs2000]

-   Por ejemplo, si varias especies de macroinvertebrados cumplen el mismo rol en la descomposici√≥n de materia org√°nica, la extinci√≥n de algunas de ellas puede no afectar gravemente el ecosistema mientras haya suficientes especies funcionalmente equivalentes.
:::

::: column
```{r}
#| echo: false
#| fig-align: "center"

knitr::include_graphics("images/probabilidad_ejemplo_extincion.png")
```
:::
:::::

## Todo esto se gener√≥ con una funci√≥n sencilla

$$
P(X = k) = \binom{n}{k} p^k (1 - p)^{n - k}
$$ Donde $p$ es probabilidad de √©xito, y $1-p$ de fracaso, en una distribuci√≥n binomial.

::: fragment
```{r}
#| echo: false
#| fig-align: "center"
#| out-width: "70%"

knitr::include_graphics("images/formula_paper.png")
```
:::

##  {.center}

```{r}
#| echo: false
#| message: false
#| warning: false
#| fig-width: 16
#| fig-height: 8
#| fig-align: "center"

# Cargar las librer√≠as necesarias
# pak::pak("plotly")
# pak::pak("metR")
library(ggplot2)
library(dplyr)
library(metR)
library(plotly)
# Definir los valores de p (probabilidades de extinci√≥n)
p_values <- seq(0.01, 0.9, by = 0.01)

# Crear una secuencia de valores para el n√∫mero de especies
S <- seq(0, 10, by = 1)

# Generar un datos frame que contenga las combinaciones de S y p
datos <- expand.grid(S = S, P_funcionamiento = p_values)

# Calcular la probabilidad de funcionamiento del ecosistema
datos <- datos %>%
  # mutate(P_funcionamiento = 1 - p^S)
  mutate(p = (1 - P_funcionamiento)^(1 / S))
  

# Crear el gr√°fico de contornos con relleno
titulo <- c("Relaci√≥n entre la probabilidad de funcionamiento del ecosistema (P)  y el n√∫mero de especies.")

ppp <-ggplot(data = datos, aes(x = S, y = P_funcionamiento, fill = p)) +
  geom_tile() +
  geom_contour(aes(z = p), color = "white",
               lwd=0.5) +
  geom_text_contour(aes(z = p), stroke = 0.2, 
                    size=5, min.size=9, check_overlap=F, skip=0)+
  labs(title = "",
       x = "N√∫mero de especies",
       y = "Probabilidad de funcionamiento del ecosistema (P) ",
       fill = "Probabilidades\nde extinci√≥n (p)") +
  theme_classic() +
  theme(axis.title = element_text(size = 20, face = 2),    
        axis.text = element_text(size = 20),     
        legend.title = element_text(size = 20, face = 2),
        legend.text = element_text(size = 20),   
        plot.title = element_text(size = 20, hjust = 0.5))+
  scale_x_continuous(breaks = scales::pretty_breaks(10),
                     expand=c(0,0))+
  scale_y_continuous(breaks = scales::pretty_breaks(10), expand=c(0,0))+
  scale_fill_viridis_c(option = "D", direction = 1) 

# ggplotly
ggplotly(ppp, tooltip = "text") %>%
  layout(
    hoverlabel = list(font = list(size = 35)),  
    hovermode = 'closest'
  ) %>%
  style(hovertemplate = 'N¬∞ Especies: %{x}<br>Prob. Func.: %{y}<br>Prob. Ext.: %{z}<extra></extra>')
```

## Exportar

```{r}
#| echo: false
#| message: false
#| warning: false
#| fig-align: "center"
#| out-width: "100%"

ppp +
  theme(axis.title = element_text(size = 12, face = 2),    
        axis.text = element_text(size = 12),     
        legend.title = element_text(size = 12, face = 2),
        legend.text = element_text(size = 12),   
        plot.title = element_text(size = 12, hjust = 0.5))
```

## Referencias

::: refs
:::
